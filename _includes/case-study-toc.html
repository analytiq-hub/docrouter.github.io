<div class="sticky top-4 border-l-2 border-gray-200 pl-6" style="position: sticky; top: 2rem; max-height: calc(100vh - 4rem); overflow-y: auto;">
    <div>
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Table of Contents</h3>
        <nav class="toc-nav">
            <div id="toc-content" class="space-y-1">
                <!-- TOC will be generated by JavaScript -->
            </div>
        </nav>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocContent = document.getElementById('toc-content');
    const headings = document.querySelectorAll('article h1, article h2, article h3, article h4, article h5, article h6');
    
    if (headings.length === 0) {
        tocContent.innerHTML = '<p class="text-sm text-gray-500 italic">No headings found</p>';
        return;
    }
    
    let tocHTML = '';
    
    headings.forEach(function(heading, index) {
        // Skip the main title (first h1)
        if (heading.tagName === 'H1' && index === 0) {
            return;
        }
        
        const level = parseInt(heading.tagName.substring(1));
        const id = heading.id || 'heading-' + index;
        const text = heading.textContent.trim();
        
        // Ensure heading has an ID
        if (!heading.id) {
            heading.id = id;
        }
        
        // Calculate indentation based on heading level
        const indentClass = level > 2 ? 'ml-' + ((level - 2) * 4) : '';
        const textSize = level === 2 ? 'text-sm font-medium' : 'text-xs';
        
        tocHTML += `
            <div class="${indentClass}">
                <a href="#${id}" class="toc-link block py-1 px-2 rounded text-gray-600 hover:text-blue-600 hover:bg-gray-50 transition-colors ${textSize}">
                    ${text}
                </a>
            </div>
        `;
    });
    
    tocContent.innerHTML = tocHTML;
    
    // Add scroll spy functionality
    const tocLinks = document.querySelectorAll('.toc-link');
    const headingElements = Array.from(headings).slice(1); // Skip first h1
    
    function updateActiveLink() {
        let current = '';
        const scrollPosition = window.scrollY + 100;
        
        headingElements.forEach(function(heading) {
            if (heading.offsetTop <= scrollPosition) {
                current = heading.id;
            }
        });
        
        tocLinks.forEach(function(link) {
            link.classList.remove('text-blue-600', 'bg-gray-50', 'font-medium');
            link.classList.add('text-gray-600');
            
            if (link.getAttribute('href') === '#' + current) {
                link.classList.remove('text-gray-600');
                link.classList.add('text-blue-600', 'bg-gray-50', 'font-medium');
            }
        });
    }
    
    // Update on scroll
    window.addEventListener('scroll', updateActiveLink);
    // Update on load
    updateActiveLink();
    
    // Smooth scroll for TOC links
    tocLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>